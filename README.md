# MoniQuest

## Overview · 개요
**English**
MoniQuest is a Progressive Web App that turns economics vocabulary into an adventurous quiz for kids. Chapters unlock as learners progress, each miss triggers a warm AI explanation generated by Gemini Flash Lite, and the app works offline thanks to its PWA shell.

**한국어**
MoniQuest는 어린이들이 경제 용어를 모험처럼 익힐 수 있도록 만든 퀴즈 기반 PWA입니다. 학습이 진행될수록 새로운 챕터가 열리고, 문제를 틀리면 Gemini Flash Lite가 생성하는 다정한 설명으로 다시 학습할 수 있으며, PWA 구조 덕분에 오프라인에서도 동작합니다.

## Key Features · 주요 기능
**English**
- Installable PWA with manifest, service worker caching, offline fallback, and GitHub Pages-compatible base path (`/MoniQuest/`).
- AI tutoring routed through a secure Vercel serverless proxy (`/api/generate`) so the Gemini key never ships to the browser.
- Randomized quiz order, answer shuffling, and varied feedback tone to keep every session feeling fresh.
- Confetti celebrations and chapter gating to reward mastery while guiding learners forward.

**한국어**
- `manifest.json`, 서비스 워커 캐싱, 오프라인 전용 페이지, `/MoniQuest/` 기본 경로를 갖춘 설치형 PWA.
- Gemini 키를 브라우저에 노출하지 않고 Vercel 서버리스 프록시(`/api/generate`)로만 AI 요청을 전달.
- 문제 순서와 선택지, 피드백 어조를 매번 섞어 반복감을 줄임.
- 챕터 잠금 해제와 폭죽 연출로 학습 성취감을 높여 다음 단계로 자연스럽게 이끕니다.

## Getting Started · 시작하기
**Prerequisites · 사전 준비**
- [Node.js](https://nodejs.org/) 18 or newer / 18 이상
- A Gemini API key with access to `models/gemini-flash-lite-latest`

### Environment variables & secrets · 환경 변수와 비밀 관리
**English**
- **Never commit the Gemini key.** Store `GEMINI_API_KEY` only inside Vercel Project Settings ▸ Environment Variables.
- Optionally create a local `.env` (or `.env.local`) with `GEMINI_API_KEY` when running `vercel dev` locally. The front-end never reads this key directly.
- If you must call a custom API host during local Vite development, set `VITE_API_BASE_URL` (e.g., `http://localhost:3000`) so the browser talks to your proxy instead of the default production endpoint.
- To allow additional production origins (such as a custom domain), set `EXTRA_ALLOWED_ORIGINS` in Vercel to a comma-separated list (e.g., `https://moniquest.vercel.app,https://learn.moniquest.com`).

**한국어**
- **Gemini 키는 절대 저장소에 커밋하지 마세요.** 키는 Vercel 프로젝트 설정의 Environment Variables에만 저장합니다.
- 로컬에서 `vercel dev`로 전체 스택을 실행할 경우 `.env` 또는 `.env.local`에 `GEMINI_API_KEY`를 추가할 수 있습니다. 프론트엔드는 이 값을 직접 읽지 않습니다.
- 로컬 Vite 개발에서 별도의 API 호스트를 호출해야 한다면 `VITE_API_BASE_URL`을 지정해 주세요(예: `http://localhost:3000`). 지정하지 않으면 기본적으로 배포된 Vercel 엔드포인트를 사용합니다.
- 프로덕션에서 커스텀 도메인을 추가하려면 Vercel 환경 변수 `EXTRA_ALLOWED_ORIGINS`에 콤마로 구분된 주소 목록을 입력하세요(예: `https://moniquest.vercel.app,https://learn.moniquest.com`).

```bash
# Optional local overrides (never commit)
GEMINI_API_KEY=your_local_testing_key
VITE_API_BASE_URL=http://localhost:3000
```

### Installation · 설치
```bash
npm install
```

### Local development · 로컬 개발
```bash
npm run dev
```
- 이 명령은 Vite 개발 서버를 실행합니다. 기본적으로 브라우저는 배포된 Vercel API(`/api/generate`)를 호출합니다.
- 전체 스택을 로컬에서 테스트하고 싶다면 [Vercel CLI](https://vercel.com/docs/cli)를 설치한 후 `vercel dev`를 실행하여 서버리스 함수와 프론트를 동시에 구동하세요.

### Production build · 프로덕션 빌드
```bash
npm run build
```
- Build artifacts are emitted to `dist/` and respect the `/MoniQuest/` base path for GitHub Pages compatibility.
- Test locally with `npm run preview` or `vercel dev` before deploying.

## Deploying to Vercel · Vercel 배포
**English**
1. Import the GitHub repository into Vercel and select the `feat/vercel-deploy` (or main) branch.
2. In **Project Settings ▸ Environment Variables**, add `GEMINI_API_KEY` (and optional `EXTRA_ALLOWED_ORIGINS` or `VITE_API_BASE_URL` overrides for staging domains). Do **not** expose the key anywhere else.
3. Deploy. Vercel builds the Vite front-end, provisions the `/api/generate` serverless function, and serves everything from `https://moniquest.vercel.app/MoniQuest/` by default.
4. After deployment, visit `/MoniQuest/`, check DevTools ▸ Network for successful calls to `/api/generate`, and verify offline fallback via DevTools ▸ Application ▸ Service Workers.

**한국어**
1. GitHub 저장소를 Vercel에 연결하고 배포할 브랜치(예: `feat/vercel-deploy` 또는 `main`)를 선택합니다.
2. **Project Settings ▸ Environment Variables**에 `GEMINI_API_KEY`를 추가합니다. 필요하다면 `EXTRA_ALLOWED_ORIGINS`, `VITE_API_BASE_URL` 같은 보조 환경 변수를 설정하여 스테이징 도메인을 허용하세요. 키는 다른 곳에 노출하지 않습니다.
3. 배포를 실행하면 Vercel이 Vite 프론트엔드와 `/api/generate` 서버리스 함수를 함께 빌드하여 기본적으로 `https://moniquest.vercel.app/MoniQuest/` 경로에서 제공합니다.
4. 배포 후 `/MoniQuest/`에 접속하여 네트워크 패널에서 `/api/generate` 호출 성공 여부를 확인하고, DevTools ▸ Application ▸ Service Workers에서 오프라인 모드를 테스트하세요.

> **Tip · 팁**
> - GitHub Pages를 계속 운영하려면 별도의 워크플로로 `dist/`를 업로드하고, 프론트엔드에서 `VITE_API_BASE_URL`을 `https://moniquest.vercel.app`로 지정하면 됩니다.

## API Proxy · 서버리스 프록시
- **Route**: `POST /api/generate`
- **Purposes**:
  - `quiz-explanation` – returns a friendly Korean explanation when a learner misses a quiz question.
  - `chat-response` – sends conversational answers from 리라 the tutor.
- **Security**:
  - Only CORS origins in the whitelist (`https://ers123.github.io`, `https://moniquest.vercel.app`, plus any `EXTRA_ALLOWED_ORIGINS`) are allowed.
  - Requests beyond a simple in-memory rate limit receive `{ error: { code: 'rate_limited', message: ... } }`.
  - Errors follow `{ error: { code, message } }`; successful calls return `{ result }`.

## Security · 보안 안내
**English**
- The Gemini key lives exclusively in Vercel environment variables. Rotate it immediately if you suspect exposure.
- The repository ships with [`.gitleaks.toml`](./.gitleaks.toml) to flag Google-style keys during CI or pre-commit checks. Run `gitleaks detect` locally before pushing sensitive changes.
- See [SECURITY.md](./.github/SECURITY.md) for responsible disclosure steps and supported versions.

**한국어**
- Gemini 키는 Vercel 환경 변수에만 저장하세요. 노출이 의심되면 즉시 키를 교체합니다.
- 저장소에 포함된 [`.gitleaks.toml`](./.gitleaks.toml)은 Google API 키 패턴을 감지하도록 구성되어 있습니다. 민감한 변경사항을 푸시하기 전에 `gitleaks detect` 명령으로 점검할 수 있습니다.
- 지원 버전과 취약점 제보 절차는 [SECURITY.md](./.github/SECURITY.md)를 참고하세요.

## Testing & Quality Checks · 테스트 및 품질 확인
```bash
npm run build
npm run preview
```
- While previewing, toggle DevTools ▸ Network to **Offline** to confirm `offline.html` loads as the fallback.
- Deploys automatically bump the service-worker cache version (`public/sw.js`), so remember to update that constant (`CACHE_VERSION`) whenever shipping new assets.

## Project Structure · 프로젝트 구조
```
├── api/
│   └── generate.ts        # Vercel serverless function wrapping Gemini calls with CORS and rate limiting
├── App.tsx                # Global layout, routing, and app context
├── components/            # Quiz UI, onboarding, chatbot, confetti effects
├── services/geminiService.ts # Front-end helper that calls the /api/generate proxy
├── public/
│   ├── manifest.json      # PWA manifest (maskable icons, screenshots, shortcuts)
│   ├── sw.js              # Service worker with versioned caching & offline fallback
│   ├── 404.html           # SPA fallback so GitHub Pages refreshes work
│   ├── offline.html       # Friendly offline message when network is unreachable
│   ├── config.template.json # Legacy template (kept for reference; never commit config.json)
│   ├── moni_icon.png      # PWA install icon
│   └── moni_image.png     # Open Graph / social preview image
├── index.html             # HTML shell with OG/Twitter metadata and fonts
├── index.tsx              # React entry point and service worker registration
├── types.ts               # Shared TypeScript types for quiz content
├── vite.config.ts         # Vite configuration with `/MoniQuest/` base path
└── README.md              # This guide (English & Korean)
```

## PWA Tips · PWA 사용 팁
**English**
- Add the app to the home screen on Chrome, Edge, or Safari to enjoy the standalone layout.
- When shipping updates, bump `CACHE_VERSION` in `public/sw.js` so returning users receive the latest bundle instantly.
- Customize the Open Graph title/description in `index.html` for upcoming campaigns or seasonal learning themes.

**한국어**
- Chrome, Edge, Safari에서 홈 화면에 추가하면 전체 화면 모드로 학습 앱을 사용할 수 있습니다.
- 새 버전을 배포할 때는 `public/sw.js`의 `CACHE_VERSION` 값을 올려 기존 사용자가 최신 자산을 즉시 받도록 하세요.
- 캠페인이나 학습 테마에 맞춰 `index.html`의 오픈 그래프 제목과 설명을 수정하면 공유 시 더 눈에 띕니다.

즐거운 경제 모험 되세요! ✨
